# Multi-Cloud Cost Monitor - Production Configuration
# Optimized for production environments with enhanced security and monitoring

clouds:
  aws:
    enabled: true
    region: "us-east-1"

    # Production: Use IAM roles/instance profiles when possible
    # profile: "production-cost-monitor"

    cost_explorer:
      granularity: "DAILY"
      metrics: ["BlendedCost", "UnblendedCost"]
      group_by: ["SERVICE", "LINKED_ACCOUNT"]

    thresholds:
      warning: 5000.0   # $5,000 daily warning
      critical: 10000.0 # $10,000 daily critical

    icinga:
      check_interval: 1800  # 30 minutes for production
      notification_enabled: true

  azure:
    enabled: true

    # Production: Use managed identities when possible
    # Environment variables for service principal:
    # AZURE_SUBSCRIPTION_ID
    # AZURE_TENANT_ID
    # AZURE_CLIENT_ID
    # AZURE_CLIENT_SECRET

    cost_management:
      granularity: "Daily"
      scope_type: "Subscription"

    thresholds:
      warning: 4000.0
      critical: 8000.0

    icinga:
      check_interval: 1800
      notification_enabled: true

  gcp:
    enabled: true

    # Production: Use application default credentials or service accounts
    # Environment variables:
    # GOOGLE_APPLICATION_CREDENTIALS (path to service account JSON)
    # GCP_PROJECT_ID
    # GCP_BILLING_ACCOUNT_ID

    billing:
      currency: "USD"

    # BigQuery billing export for detailed cost analysis
    bigquery_billing_dataset: "billing_export"
    bigquery_billing_table: "gcp_billing_export_v1_"

    thresholds:
      warning: 3000.0
      critical: 6000.0

    icinga:
      check_interval: 1800
      notification_enabled: true

# Production monitoring settings
monitoring:
  thresholds:
    warning: 12000.0   # Combined daily warning
    critical: 24000.0  # Combined daily critical

  icinga:
    check_interval: 1800
    notification_enabled: true
    performance_data: true
    output_format: "nagios"

    # Production-specific exit codes
    exit_codes:
      ok: 0
      warning: 1
      critical: 2
      unknown: 3

  alerts:
    enabled: true
    console_output: false  # Disable console in production

    # Email alerts for production
    email:
      enabled: true
      smtp_host: "smtp.company.com"
      smtp_port: 587
      smtp_tls: true
      from_address: "cost-monitor@company.com"
      to_addresses:
        - "finops@company.com"
        - "devops@company.com"
        - "alerts@company.com"

# Production dashboard - disabled by default for security
dashboard:
  enabled: false  # Enable only if needed
  host: "127.0.0.1"  # Localhost only for security
  port: 8050
  debug: false
  auto_refresh: true
  refresh_interval: 300

  # Enable authentication for production dashboard
  authentication:
    enabled: true
    type: "basic"  # basic, oauth2, saml

  # SSL/TLS configuration
  ssl:
    enabled: true
    cert_file: "/etc/ssl/certs/cost-monitor.crt"
    key_file: "/etc/ssl/private/cost-monitor.key"

# Production caching for better performance
cache:
  enabled: true
  type: "disk"  # Persistent across restarts
  ttl: 3600
  max_size: "500MB"  # Larger cache for production
  directory: "/var/cache/cost-monitor"

  # Optimized provider-specific TTLs
  aws:
    ttl: 3600    # AWS updates 3-4 times daily
  azure:
    ttl: 2700    # Azure updates hourly, cache for 45 minutes
  gcp:
    ttl: 2700    # GCP updates hourly, cache for 45 minutes

# Production logging configuration
logging:
  level: "INFO"
  format: "structured"  # JSON format for log aggregation
  file: "/var/log/cost-monitor/cost-monitor.log"
  max_size: "50MB"
  backup_count: 10

  # Syslog for centralized logging
  syslog:
    enabled: true
    host: "syslog.company.com"
    port: 514
    facility: "local0"

# Conservative rate limiting for production
rate_limiting:
  aws:
    calls_per_minute: 50    # Conservative for Cost Explorer
    retry_attempts: 5
    backoff_factor: 2

  azure:
    calls_per_minute: 80    # Azure allows more
    retry_attempts: 3
    backoff_factor: 1.5

  gcp:
    calls_per_minute: 100   # GCP has higher limits
    retry_attempts: 4
    backoff_factor: 2

# Security settings
security:
  # Encrypt sensitive configuration values
  encryption:
    enabled: true
    key_file: "/etc/cost-monitor/encryption.key"

  # Audit logging
  audit:
    enabled: true
    log_file: "/var/log/cost-monitor/audit.log"

  # Network restrictions
  allowed_networks:
    - "10.0.0.0/8"      # Internal networks only
    - "172.16.0.0/12"
    - "192.168.0.0/16"

# Health check endpoints
health:
  enabled: true
  port: 8080
  path: "/health"

  checks:
    - name: "cloud_auth"
      enabled: true
    - name: "cache"
      enabled: true
    - name: "database"
      enabled: false

# Backup and disaster recovery
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention_days: 90
  storage:
    type: "s3"
    bucket: "company-cost-monitor-backups"
    region: "us-west-2"

# Performance monitoring
performance:
  metrics:
    enabled: true
    endpoint: "http://prometheus.company.com:9090"
    interval: 60  # seconds

  profiling:
    enabled: false  # Enable only for debugging
    port: 6060

# Development overrides - comment out in production
# development:
#   mock_data: false
#   debug_api_calls: false
#   skip_auth_validation: false