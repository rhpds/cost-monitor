# OAuth2 Proxy Secret Template
#
# This file contains the secret structure needed for OAuth2 proxy.
# Values should be provided via environment-specific overlays or external secret management.
#
# To generate the required secrets:
#
# 1. Cookie Secret (32 bytes, base64 encoded):
#    python3 -c "import secrets, base64; print(base64.b64encode(secrets.token_bytes(32)).decode())"
#
# 2. Client Secret:
#    Generate via: oc get oauthclient cost-monitor-oauth-client -o jsonpath='{.secret}'
#
# 3. Client ID:
#    Should match the OAuthClient name: cost-monitor-oauth-client

---
apiVersion: v1
kind: Secret
metadata:
  name: oauth-proxy-secret
  labels:
    app: cost-monitor
    component: oauth
    tier: security
type: Opaque
stringData:
  # OAuth Client credentials (generated by OpenShift)
  client-id: "cost-monitor-oauth-client"
  client-secret: ""  # REPLACE: Get from 'oc get oauthclient cost-monitor-oauth-client -o jsonpath="{.secret}"'

  # Cookie encryption key (32 random bytes, base64 encoded)
  cookie-secret: ""  # REPLACE: Generate with: python3 -c "import secrets, base64; print(base64.b64encode(secrets.token_bytes(32)).decode())"

---
# User Role Mapping ConfigMap
# Maps authenticated users to application roles
apiVersion: v1
kind: ConfigMap
metadata:
  name: user-roles
  labels:
    app: cost-monitor
    component: auth
data:
  # Role definitions
  roles.yaml: |
    roles:
      admin:
        description: "Full access to all cost data and configuration"
        permissions:
          - "costs:read"
          - "costs:export"
          - "config:read"
          - "config:write"
          - "users:manage"

      analyst:
        description: "Read access to cost data with export capabilities"
        permissions:
          - "costs:read"
          - "costs:export"

      viewer:
        description: "Read-only access to cost data"
        permissions:
          - "costs:read"

      service:
        description: "Service account access for monitoring integrations"
        permissions:
          - "costs:read"
          - "health:read"

  # User to role mapping
  # Format: username: [role1, role2]
  users.yaml: |
    users:
      # OpenShift cluster admins get full access
      system:admin:
        - admin

      # Example user mappings (replace with actual usernames)
      # john.doe@company.com:
      #   - admin
      # jane.smith@company.com:
      #   - analyst
      # finance-team@company.com:
      #   - analyst
      # readonly-dashboard@company.com:
      #   - viewer

      # Service accounts
      prometheus:
        - service
      grafana:
        - service

  # Group to role mapping (if using LDAP/AD groups)
  groups.yaml: |
    groups:
      # Example group mappings
      # cost-monitor-admins:
      #   - admin
      # finance-analysts:
      #   - analyst
      # engineering-leads:
      #   - viewer

      # OpenShift groups
      cluster-admins:
        - admin

  # Default role for authenticated users not explicitly mapped
  default.yaml: |
    default_role: "viewer"

    # Whether to allow access for users not in explicit mappings
    allow_unmapped_users: true

    # Whether to require explicit role mapping
    require_explicit_mapping: false
